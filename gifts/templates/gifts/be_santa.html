{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen flex items-center justify-center relative overflown-hidden py-10">

    <!-- Soft Background Decor -->
    <div class="absolute inset-0 z-0">
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-green-900/10 rounded-full blur-3xl animate-float"></div>
        <div class="absolute bottom-1/3 right-1/4 w-80 h-80 bg-red-900/10 rounded-full blur-3xl animate-float"
            style="animation-delay: 2s;"></div>
    </div>

    <!-- Main Card -->
    <div class="relative z-10 w-full max-w-2xl px-6">
        <div class="glass-panel p-8 md:p-12 animate-fade-in">

            <!-- Header -->
            <div class="text-center mb-10">
                <h1 class="font-hand text-5xl md:text-6xl text-gold-accent mb-4">Be Santa</h1>

                <div class="max-w-md mx-auto space-y-4">
                    <p class="text-white/80 font-serif italic text-lg leading-relaxed">
                        ‚ÄúYou are about to give a gift with no expectations attached. This is not about value, status, or
                        reward. It‚Äôs about kindness ‚Äî given freely, quietly, and with care. Your gift will reach someone
                        who needs a little hope.‚Äù
                    </p>
                </div>
            </div>

            <!-- Instructions -->
            <div class="mb-8 p-6 bg-white/5 rounded-2xl border border-white/10 text-center space-y-3">
                <p class="text-white/70 text-sm">üì∏ Upload a photo of the gift you wish to give</p>
                <p class="text-white/70 text-sm">üéÅ The gift should be neatly and beautifully packed</p>
                <p class="text-white/70 text-sm">‚ù§Ô∏è This image helps us prepare and collect the gift respectfully</p>
                <p class="text-gold-accent/80 text-xs mt-2 font-medium">There is no limit to how many gifts you can give
                </p>
            </div>

            <form method="post" enctype="multipart/form-data" class="space-y-8" id="gift-form">
                {% csrf_token %}

                <!-- Image Upload Field -->
                <div class="group">
                    <label class="block text-sm font-medium text-white/80 pl-1 mb-3">Upload Your Gift</label>
                    <div class="relative w-full aspect-video border-2 border-dashed border-white/20 rounded-2xl bg-black/10 hover:bg-black/20 hover:border-gold-accent/40 transition-all cursor-pointer overflow-hidden flex flex-col items-center justify-center"
                        id="drop-zone">

                        <!-- Upload Input using Form Widget -->
                        {{ form.image }}

                        <!-- Placeholder Content -->
                        <div class="text-center p-6 space-y-3 transition-opacity duration-300" id="upload-placeholder">
                            <div
                                class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-2 group-hover:scale-110 transition-transform">
                                <span class="text-3xl">üì∑</span>
                            </div>
                            <p class="text-white/90 font-medium">Click to upload photo</p>
                            <p class="text-white/50 text-xs">A simple photo of your packed gift is enough.<br>Format:
                                JPG, PNG, JPEG</p>
                        </div>

                        <!-- Preview Image (Hidden initially) -->
                        <img id="image-preview" src="#" alt="Gift Preview"
                            class="absolute inset-0 w-full h-full object-cover hidden">

                        <!-- Remove/Change Overlay on Preview -->
                        <div id="change-overlay"
                            class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity hidden">
                            <p class="text-white text-sm font-medium">Click to change photo</p>
                        </div>
                    </div>
                    {% if form.image.errors %}
                    <p class="text-red-300 text-xs pl-1 mt-2 text-center">{{ form.image.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Optional Note -->
                <div class="space-y-2">
                    <label for="{{ form.note.id_for_label }}" class="block text-sm font-medium text-white/80 pl-1">A
                        Note from Santa <span class="text-white/40 text-xs font-normal ml-1">(optional)</span></label>
                    {{ form.note }}
                </div>

                <!-- Submit Button -->
                <button type="submit" id="submit-btn"
                    class="w-full relative group overflow-hidden bg-gradient-to-r from-gold-accent to-yellow-500 text-red-900 font-bold py-4 rounded-xl shadow-[0_0_20px_rgba(255,215,0,0.2)] hover:shadow-[0_0_30px_rgba(255,215,0,0.4)] transform hover:scale-[1.01] transition-all duration-300">
                    <span class="relative z-10 flex items-center justify-center gap-2" id="btn-text">
                        üëâ Give with Kindness
                    </span>
                    <span class="relative z-10 flex items-center justify-center gap-2 hidden" id="loading-text">
                        <svg class="animate-spin h-5 w-5 text-red-900" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        Spreading kindness...
                    </span>
                    <div
                        class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                    </div>
                </button>
            </form>

        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const changeOverlay = document.getElementById('change-overlay');
        const form = document.getElementById('gift-form');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const loadingText = document.getElementById('loading-text');

        // Trigger input on zone click
        dropZone.addEventListener('click', () => fileInput.click());

        // Handle File Selection
        fileInput.addEventListener('change', function () {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    uploadPlaceholder.classList.add('hidden');
                    changeOverlay.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        });

        // Submit Animation
        form.addEventListener('submit', (e) => {
            // Basic Check if empty
            if (!fileInput.files.length) {
                e.preventDefault();
                alert('Please upload a photo of your gift.');
                return;
            }

            submitBtn.disabled = true;
            btnText.classList.add('hidden');
            loadingText.classList.remove('hidden');
            submitBtn.classList.add('opacity-90', 'cursor-wait');
        });
    });
</script>
{% endblock %}